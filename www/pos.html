<html>

<head>
    <title>GNSS Position</title>
    <script src="jquery-3.4.1.min.js"></script>
    <script src="bs-4.3.1.bundle.min.js"></script>
    <script src="proj4js-2.8.0.min.js"></script>
    <link rel="stylesheet" href="bs-4.3.1.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <script>
        proj4.defs(
            "EPSG:3765",
            "+proj=tmerc +lat_0=0 +lon_0=16.5 +k=0.9999 +x_0=500000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
        );

        function badgeOnOff(id, isOn) {
            if (isOn) {
                document.getElementById(id).className = "badge badge-primary";
            } else {
                document.getElementById(id).className = "badge badge-secondary";
            }
        }

        var latitude = $("#latitude");

        var posUpdate = function () {
            $.ajax({
                url: "ubx/pos",
                dataType: "json",
                timeout: 2000,
            })
                .done(function (data) {
                    document.getElementById("fixType").textContent = data.fixType;
                    badgeOnOff("gnssFixOK", data.gnssFixOK);
                    if (data.corrSoln == 0) {
                        $("#rtk").text("No RTK");
                        document.getElementById("rtk").className =
                            "badge badge-secondary";
                    } else if (data.corrSoln == 1) {
                        $("#rtk").text("RTK Float");
                        document.getElementById("rtk").className = "badge badge-warning";
                    } else if (data.corrSoln == 2) {
                        $("#rtk").text("RTK Fixed");
                        document.getElementById("rtk").className = "badge badge-primary";
                    }
                    $("#latitude").text(data.lat);
                    $("#longitude").text(data.lon);
                    $("#height").text(data.height.toFixed(3));
                    $("#hMSL").text(data.hMSL.toFixed(3));
                    $("#hAcc").text(data.hAcc.toFixed(3));
                    $("#vAcc").text(data.vAcc.toFixed(3));
                    htrs = proj4("EPSG:4326", "EPSG:3765", [data.lon, data.lat]);
                    $("#htrs").text(htrs[0].toFixed(2) + ", " + htrs[1].toFixed(2));
                })
                .always(function () {
                    setTimeout(posUpdate, 2500);
                });
        };
        posUpdate();
    </script>
</head>

<body class="bg-light">
    <div class="container">
        <div class="row mb-1">
            <div class="col-xl-6">
                <div class="card mb-3">
                    <div class="card-header">GNSS Position</div>
                    <div class="card-body">
                        <table class="table table-sm">
                            <tbody>
                                <tr>
                                    <th scope="row">Fix Type</th>
                                    <td>
                                        <span id="fixType"></span>
                                        <span id="gnssFixOK" class="badge badge-secondary">OK</span>
                                        <span id="rtk" class="badge badge-secondary">RTK</span>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">Latitude</th>
                                    <td id="latitude"></td>
                                    <td>deg</td>
                                </tr>
                                <tr>
                                    <th scope="row">Longitude</th>
                                    <td id="longitude"></td>
                                    <td>deg</td>
                                </tr>
                                <tr>
                                    <th scope="row">Height</th>
                                    <td id="height">n/a</td>
                                    <td>m</td>
                                </tr>
                                <tr>
                                    <th scope="row">Height (MSL)</th>
                                    <td id="hMSL">n/a</td>
                                    <td>m</td>
                                </tr>
                                <tr>
                                    <th scope="row">Horizontal Accuracy</th>
                                    <td id="hAcc">n/a</td>
                                    <td>m</td>
                                </tr>
                                <tr>
                                    <th scope="row">Vertical Accuracy</th>
                                    <td id="vAcc">n/a</td>
                                    <td>m</td>
                                </tr>
                                <tr>
                                    <th scope="row">HTRS96/TM</th>
                                    <td id="htrs">n/a</td>
                                    <td>m</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
